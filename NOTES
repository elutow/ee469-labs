TODO:

- implement load pre-increment, don't write back
Pipelining: Implement bubbles/no-ops and bypasses
- Register values for immediate register read after register write
- take values from beginning of stages back into beginning of previous stages
    e.g. WB -> Exe, Mem -> Ex
- bubbles for updating CPSR and delaying next instruction
- bubbles for branching
    - two options for adding bubbles:
        1. stall decode, fetch
        2. continue to fetch, but if branch is taken, then get rid of decode and fetch instructions. This is the faster solution

From Slack channel (Han Yang Du):

Anyway if youre attempting to view the block ram pass through the build log you wanna look for 30.24. Executing MEMORY_BRAM pass (mapping $mem cells to block memories). in the yosys build log and then you'll see a line that goes Processing top.the_cpu.data_mem.mem: with data_mem and mem being whatever you called your stuff. If it mapped successfully, it'll eventually output something like
Creating $__ICE40_RAM4K_M0 cell at grid position <0 0 0>: the_cpu.data_mem.mem.0.0.0
Creating $__ICE40_RAM4K_M0 cell at grid position <1 0 0>: the_cpu.data_mem.mem.1.0.0
If it failed, it'll output
No acceptable bram resources found.
For me, a byte addressable big endian memory system reg [7:0] mem [0:???] couldnt map to bram but a word addressable memory reg [31:0] mem [0:???] worked fine

Modules shared between modules:
- regfile

Cycles with modules:

=== Cycle 0 ===

fetcher
- Fetch instruction

=== Cycle 1 ===

decoder
- Read regfile

=== Cycle 2 ===

executor
- Executes the instruction
- Access data memory (load or store). This serves the function of the memory access stage

=== Cycle 3 ===

writeback
- Write back to regfile

Yosys testing (at commit b6bea328e7b917e933cdc702ebbe70706b092d74)
==================================================================

Yosys 0.9 (stable) statistics with "synth_ice40 -retime -relut -abc2":

Number of wires:               8115
Number of wire bits:          13735
Number of public wires:         821
Number of public wire bits:    5851
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7919
SB_CARRY                      442
SB_DFF                        868
SB_DFFE                       453
SB_IO                           2
SB_LUT4                      6145
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

Yosys 0.9 (stable) statistics with just "synth_ice40":

Number of wires:               6537
Number of wire bits:          12204
Number of public wires:         742
Number of public wire bits:    5654
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7771
SB_CARRY                      442
SB_DFF                        267
SB_DFFE                       696
SB_DFFESR                     185
SB_DFFESS                      53
SB_DFFSR                      172
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5940
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

Yosys 0.9 (stable) statistics with "synth_ice40 -abc2 -relut":

Number of wires:               6522
Number of wire bits:          12234
Number of public wires:         823
Number of public wire bits:    5780
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7674
SB_CARRY                      442
SB_DFF                        267
SB_DFFE                       696
SB_DFFESR                     185
SB_DFFESS                      53
SB_DFFSR                      172
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5843
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

Yosys 0.9 (stable) statistics with "synth_ice40 -abc2":

Number of wires:               6556
Number of wire bits:          12268
Number of public wires:         823
Number of public wire bits:    5780
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7709
SB_CARRY                      442
SB_DFF                        267
SB_DFFE                       696
SB_DFFESR                     185
SB_DFFESS                      53
SB_DFFSR                      172
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5878
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

yosys 0.9-dev6edca05 statistics with "synth_ice40"

Number of wires:               6327
Number of wire bits:          11974
Number of public wires:        6327
Number of public wire bits:   11974
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7523
SB_CARRY                      442
SB_DFF                        271
SB_DFFE                       694
SB_DFFESR                     182
SB_DFFESS                      53
SB_DFFSR                      174
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5691
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

yosys 0.9-dev6edca05 statistics with "synth_ice40 -abc2"

Number of wires:               6407
Number of wire bits:          12099
Number of public wires:        6407
Number of public wire bits:   12099
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7522
SB_CARRY                      442
SB_DFF                        271
SB_DFFE                       694
SB_DFFESR                     182
SB_DFFESS                      53
SB_DFFSR                      174
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5690
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

yosys 0.9-dev6edca05 statistics with "synth_ice40 -abc2 -relut"

Number of wires:               6407
Number of wire bits:          12099
Number of public wires:        6407
Number of public wire bits:   12099
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7522
SB_CARRY                      442
SB_DFF                        271
SB_DFFE                       694
SB_DFFESR                     182
SB_DFFESS                      53
SB_DFFSR                      174
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5690
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

yosys 0.9-dev6edca05 statistics with "synth_ice40 -abc9" (NOTE: -abc9 is experimental!)

Number of wires:               5973
Number of wire bits:          11644
Number of public wires:        5973
Number of public wire bits:   11644
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               7159
SB_CARRY                      442
SB_DFF                        271
SB_DFFE                       694
SB_DFFESR                     182
SB_DFFESS                      53
SB_DFFSR                      174
SB_DFFSS                        5
SB_IO                           2
SB_LUT4                      5327
SB_PLL40_CORE                   1
SB_RAM40_4K                     8

Yosys testing at commit d1096c4bc97d3c3ba8bf5023d8730ac831ae3909
==========================================================

yosys 0.9-dev6edca05 statistics with "synth_ice40 -abc9" (NOTE: -abc9 is experimental!)

Number of wires:               2849
Number of wire bits:           7687
Number of public wires:        2849
Number of public wire bits:    7687
Number of memories:               0
Number of memory bits:            0
Number of processes:              0
Number of cells:               3583
SB_CARRY                      420
SB_DFF                        307
SB_DFFE                       182
SB_DFFESR                     182
SB_DFFESS                      53
SB_DFFSR                      170
SB_DFFSS                        6
SB_IO                           2
SB_LUT4                      2250
SB_PLL40_CORE                   1
SB_RAM40_4K                    10
